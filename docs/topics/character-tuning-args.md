
# Stable Diffusion 人物调参

## 复现

::: tip 高度相似的成品
高度相似的成品 = 相同的 seed + 相同的 size + 相同的 prompts + 相同的 CFG Scale + 相同的 Sampling 相同的 Denoising strength
:::

- seed & size 影响人物的动作/行为 
- prompts 影响人物的风格特征, 例如 [服装提示词](https://csausk.github.io/docs/topics/dress-up-prompt.html).
- CFG Scale 一般取 `7`, 指定生成时忽视 prompts 的程度
- Sampling 包含 `Sampling Method & Sampling Step` 两项, 对成品的影响程度 `Sampling Method > Sampling Step`. 
即采样方法的选择比采样步长的大小更容易影响结果, 但除去风格试验环节, 采样方法一般不轻易更改. 
  - 常见的采样方法中, Euler Method 比 DDIM (生成扩散模型) 更稳定, 但 DDIM 在 **生成** 上往往能取得更好的效果 (相应的, 作画崩坏的概率会更高). 
  - 对于不同风格的模型, 采样方法也有不同的选择. 比如对于真实的人物场景, 使用 DDIM 系有望取得更好的效果.
- 采样步长常取 `20 ≤ x ≤ 30`. 越小采样越随机
- Denoising strength 降噪强度常取 `0.5` 或 `0.75` (default).

## 崩坏控制

### 可能的原因

对于人物来说, 不同部位的错误, 原因也基本不同, 可以分以下几种考虑

- 手指. 

  这个概率极高, 对成品的影响一般是 `extra fingers`. 
  原因也很明显, 就是模型中的手指状态多、风格不固定, 对于生成器来说就是 “用于确定预生成的图像合理” 的信息量不足.

- 脸. 
  
  几乎不出错, 一旦出错往往都是临时更改了等式 “高度相似的成品” 右侧中的某些参数. 特别是以下几点影响明显
  
  - 图像尺寸. 
    
    由于训练模型时的数据与希望生成的图像尺寸严重不匹配导致脸部的一些特征无法确定, 而脸部一旦出现问题是最容易被注意到的.
  
  - 提示词. 
    
    一些特殊的提示词权重过高时会关联到训练数据中质量不高的图像 (因为高质量图像往往不包含这些特殊提示词描述的特征). 
  
  - Lora 权重. 
    
    受 Lora 训练数据的质量影响, 多个 Lora 组合时不适当的权重将会导致组合出的效果劣于任何单一的 Lora. 
    此处关于权重的选择依赖于使用的 Lora, 一些较好的权重选择基本都是通过大量尝试得出的. 
    因此对于任意的 Lora, 在这个问题上暂且不存在有效的方案, 不过可以尝试以下几点去避免频繁地选择不适当的权重.
    
    - 两个风格多样的具有多种脸部数据的 Lora 一般均匀分配, 不宜使用一个权重极大另一个权重极小的组合.
    - 一个风格固定的 Lora (例如特定的某个角色训练出来的 Lora) 和一个风格多样的 Lora, 

如果希望成品的脸部风格更倾向于固定风格的 Lora, 显然固定风格 Lora 的权重应高于多样风格 Lora 的权重, 
但前者与后者的权重比值应接近 `1:0.5`. 另, 所有的超高权重 (大于 `3`) 都非常容易导致整张图像的合理性从而导致崩坏, 
权重在一定程度上也能决定对应特征在成品当中的 “量”.

- 脚. 
  
  一般是采用了模型中数据相对较少的动作.

## 局部重绘

